// ====================================
// ุงูุจูุงูุงุช ุงูุชูุตูููุฉ ููุญุฑูู
// ====================================
const letterDetails = {
  ุฃ: {
    title: "ุญุฑู ุงูุฃูู - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ุงูุฌูู (ุงูุฎูุงุก ุงูุฏุงุฎู ูู ุงููู ูุงูุญูู)<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ูุฎุฑุฌ ุงูุญุฑู ูู ุงูุฌูู ุจูุฏ ุงูุตูุช<br>
            - ูุง ูุนุชูุฏ ุนูู ูุฎุฑุฌ ูุญุฏุฏ ูู ุงููู<br>
            - ููุชุฏ ุงูุตูุช ูู ุงูุฎูุงุก ุงูุฏุงุฎูู<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุญุฑู ูุฏ: ููุฏ ุจููุฏุงุฑ ุญุฑูุชูู ุฃู ุฃูุซุฑ ุญุณุจ ุงูุฃุญูุงู<br>
            - ุงูุฑุฎุงูุฉ: ูุฌุฑู ูุนู ุงูุตูุช<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู ุนูุฏ ุงููุทู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู ุนูุฏ ุงููุทู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ูุง ูููู ุฅูุง ุณุงููุงู ููุง ูุจูู ููุชูุญ<br>
            - ูู ุญุฑูู ุงููุฏ ุงูุซูุงุซุฉ (ุงุ ูุ ู)
        `,
  },
  ุจ: {
    title: "ุญุฑู ุงูุจุงุก - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ุงูุดูุชุงู (ูู ุงูุทุจุงูููุง)<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ููุทุจู ุงูุดูุชุงู ุนูู ุจุนุถููุง ุงูุทุจุงูุงู ูุญููุงู<br>
            - ุซู ูููุฑุฌุงู ูุฌุฃุฉ ูุน ุฎุฑูุฌ ุงูุตูุช<br>
            - ูุตุงุญุจู ุฌูุฑ ูุดุฏุฉ<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุงูุฌูุฑ: ูุฌุฑู ูุนู ุงูููุณ ููุง ูุฌุฑู ูุนู ุงูุตูุช ุนูุฏ ุณูููู<br>
            - ุงูุดุฏุฉ: ููุญุจุณ ุงูุตูุช ุนูุฏ ุงููุทู ุจู ุซู ูููุฌุฑ<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู<br>
            - ุงูุฅุฐูุงู: ุณูููุฉ ุงููุทู ุจู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ูุฌุจ ุชุญููู ุงูุทุจุงู ุงูุดูุชูู ุงููุงูู<br>
            - ุนุฏู ุงููุจุงูุบุฉ ูู ุงูุดุฏุฉ
        `,
  },
  ุช: {
    title: "ุญุฑู ุงูุชุงุก - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ุทุฑู ุงููุณุงู ูุน ุฃุตูู ุงูุซูุงูุง ุงูุนููุง<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ูุตุนุฏ ุทุฑู ุงููุณุงู ุฅูู ุฃุตูู ุงูุซูุงูุง ุงูุนููุง<br>
            - ูุญุฏุซ ุงูุญุจุงุณ ููุตูุช ุซู ุงููุฌุงุฑ<br>
            - ุงูุตูุช ููููุณ ุฎููู<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุงูููุณ: ูุฌุฑู ูุนู ุงูููุณ ููุง ูุฌุฑู ูุนู ุงูุตูุช<br>
            - ุงูุดุฏุฉ: ููุญุจุณ ุงูุตูุช ุซู ูููุฌุฑ<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ุงูุชูููุฒ ุจููู ูุจูู ุงูุทุงุก ุจุนุฏู ุงูุฅุทุจุงู<br>
            - ุนุฏู ุงูุฎูุท ุจููู ูุจูู ุงูุซุงุก
        `,
  },
  ุซ: {
    title: "ุญุฑู ุงูุซุงุก - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ุทุฑู ุงููุณุงู ูุน ุฃุทุฑุงู ุงูุซูุงูุง ุงูุนููุง<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ููุถุน ุทุฑู ุงููุณุงู ุนูู ุฃุทุฑุงู ุงูุซูุงูุง ุงูุนููุง<br>
            - ูุฎุฑุฌ ุงูููุงุก ูุน ุงุญุชูุงู ุฎููู<br>
            - ุงูุตูุช ุฑุฎู ููููุณ<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุงูููุณ: ูุฌุฑู ูุนู ุงูููุณ<br>
            - ุงูุฑุฎุงูุฉ: ูุฌุฑู ูุนู ุงูุตูุช<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ุงูุชูููุฒ ุจููู ูุจูู ุงูุณูู ูุงูุชุงุก<br>
            - ุฅุธูุงุฑ ุทุฑู ุงููุณุงู ููููุงู ุจูู ุงูุฃุณูุงู
        `,
  },
  ุฌ: {
    title: "ุญุฑู ุงูุฌูู - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ูุณุท ุงููุณุงู ูุน ุงูุญูู ุงูุฃุนูู<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ูุฑุชูุน ูุณุท ุงููุณุงู ูุญู ุงูุญูู ุงูุฃุนูู<br>
            - ููุญุจุณ ุงูุตูุช ุซู ูููุฌุฑ ูุน ุฌูุฑ<br>
            - ูุชููุฒ ุจุตูุช ูุฌููุฑ ุดุฏูุฏ<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุงูุฌูุฑ: ูุง ูุฌุฑู ูุนู ุงูููุณ<br>
            - ุงูุดุฏุฉ: ููุญุจุณ ุงูุตูุช<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ุนุฏู ุงููุจุงูุบุฉ ูู ุงูุชุดุฏูุฏ<br>
            - ุงููุทู ุงููุตูุญ ุฏูู ุชุนุทูุด
        `,
  },
  ุญ: {
    title: "ุญุฑู ุงูุญุงุก - ุงูุชูุงุตูู ุงููุงููุฉ",
    text: `
            <strong>ุงููุฎุฑุฌ:</strong> ูุณุท ุงูุญูู<br><br>
            
            <strong>ููููุฉ ุงููุทู:</strong><br>
            - ูุฎุฑุฌ ูู ูุณุท ุงูุญูู<br>
            - ุตูุช ุฑุฎู ููููุณ<br>
            - ูุดุนุฑ ุจุญุฑุงุฑุฉ ุฎูููุฉ ูู ุงูุญูู<br><br>
            
            <strong>ุงูุตูุงุช:</strong><br>
            - ุงูููุณ: ูุฌุฑู ูุนู ุงูููุณ<br>
            - ุงูุฑุฎุงูุฉ: ูุฌุฑู ูุนู ุงูุตูุช<br>
            - ุงูุงุณุชูุงู: ููุฎูุถ ุงููุณุงู<br>
            - ุงูุงููุชุงุญ: ูููุชุญ ุงููู<br><br>
            
            <strong>ููุงุญุธุงุช ูููุฉ:</strong><br>
            - ุงูุชูููุฒ ุจููู ูุจูู ุงููุงุก ูุงูุฎุงุก<br>
            - ุฅุฎุฑุงุฌู ูู ูุฎุฑุฌู ุงูุตุญูุญ ูู ุงูุญูู
        `,
  },
};

// ====================================
// ุฃูุซูุฉ ุงูุญุฑูู ูู ุงููุฑุขู
// ====================================
const letterExamples = {
  ุฃ: "ุฃููููู ููุดูุฑูุญู ูููู ุตูุฏูุฑููู",
  ุจ: "ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู",
  ุช: "ุชูุจููุชู ููุฏูุง ุฃูุจูู ููููุจู ููุชูุจูู",
  ุซ: "ุซูููู ุฅูููููููู ูููููู ุงููููููุงููุฉู ุชูุจูุนูุซูููู",
  ุฌ: "ุฌูุงุกู ููุตูุฑู ุงูููููู ููุงููููุชูุญู",
  ุญ: "ุงููุญูููุฏู ููููููู ุฑูุจูู ุงููุนูุงููููููู",
};

// ====================================
// ุชุญููู ุงูุฃุตูุงุช - ุฃุณุฑุน ุทุฑููุฉ ููููุฉ!
// ====================================
let audioContext;
const audioBuffers = {};
const exampleBuffers = {};
let isAudioReady = false;

// ูุงุฆูุฉ ูุตุงุฏุฑ ุงูุฃุตูุงุช
const audioSources = {
  ุฃ: "audios/hamzah.mp3",
  ู: "audios/ูุงุก.mp3",
  ุน: "audios/ุนูู.mp3",
  ุญ: "audios/ุญุงุก.mp3",
  ุบ: "audios/ุบูู.mp3",
  ุฎ: "audios/ุฎุงุก.mp3",
  ู: "audios/ูุงู.mp3",
  ู: "audios/ูุงู.mp3",
  ุฌ: "audios/ุฌูู.mp3",
  ุด: "audios/ุดูู.mp3", //ููู ุจุฏูุง ูุซุงู
  ู: "audios/ูุงุก ุบูุฑ .mp3",
  ุถ: "audios/ุถุงุฏ.mp3",
  ู: "audios/ูุงู.mp3",
  ู: "audios/ููู.mp3",
  ุฑ: "audios/ุฑุงุก.mp3",
  ุท: "audios/ุทุงุก.mp3",
  ุท: "audios/ุทุงุก.mp3",

  ุฏ: "audios/ุฏุงู.mp3",
  ุช: "audios/ุชุงุก.mp3",

  ุธ: "audios/ุธุงุก.mp3",
  ุฐ: "audios/ุฐุงู.mp3",
  ุซ: "audios/ุซุงุก ูุซุงู (2).mp3", //ููู ุจุฏูุง ูุซุงู

  ุต: "audios/ุตุงุฏ.mp3",
  ุณ: "audios/ุณูู.mp3",
  ุฒ: "audios/ุฒุงู.mp3",

  ู: "audios/ูุงุก.mp3",
  ู: "audios/ููู.mp3",
  ุจ: "audios/ุจุงุก .mp3",
  ู: "audios/ูุงู ุบูุฑ.mp3",
};

// ูุงุฆูุฉ ูุตุงุฏุฑ ุฃูุซูุฉ ุงูุญุฑูู
const exampleSources = {
  ุฃ: "audios/hamzah.mp3",
  ู: "audios/ูุงุก ูุซุงู.mp3",
  ุน: "audios/ุนูู ูุซุงู.mp3",
  ุญ: "audios/ุญุงุก ูุซุงู.mp3",
  ุบ: "audios/ุบูู ูุซุงู.mp3",
  ุฎ: "audios/ุฎุงุก ูุซุงู.mp3",
  ู: "audios/ูุงู ูุซุงู.mp3",
  ู: "audios/ูุงู ูุซุงู.mp3",
  ุฌ: "audios/ุฌูู ูุซุงู.mp3",
  ุด: "audios/ุดูู ูุซุงู.mp3",
  ู: "audios/ุดูู ูุซุงู.mp3",
  ุถ: "audios/ุถุงุฏ ูุซุงู.mp3",
  ู: "audios/ูุงู ูุซุงู.mp3",
  ู: "audios/ููู ูุซุง.mp3",
  ุฑ: "audios/ุฑุงุก ูุซุงู.mp3",
  ุท: "audios/ุทุงุก ูุซุงู.mp3",
  ุฏ: "audios/ุฏุงู ูุซุงู.mp3",
  ุช: "audios/ุชุงุก ูุซุงู.mp3",

  ุธ: "audios/ุธุงุก ูุซุงู.mp3",
  ุฐ: "audios/ุฐุงู ูุซุงู.mp3",
  ุซ: "audios/ุซุงุก ูุซุงู.mp3",

  ุต: "audios/ุตุงุฏ ูุซุงู.mp3",
  ุณ: "audios/ุงูุณูู ูุซุงู.mp3",
  ุฒ: "audios/ุฒุงู ูุซุงู.mp3",

  ู: "audios/ูุงุก ูุซุงู.mp3",
  ู: "audios/ููู ูุซุงู.mp3",
  ุจ: "audios/ุจุงุก ูุซุงู.mp3",
  ู: "audios/ูุงู ุบูุฑ ูุซุงู.mp3",
};

// ุชููุฆุฉ Audio Context
function initAudioContext() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

// ุชุญููู ููู ุตูุชู ูุงุญุฏ
// ุชุญููู ููู ุตูุชู ูุงุญุฏ
async function loadAudioFile(letter, url, targetBuffers, type = "ุญุฑู") {
  try {
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
    targetBuffers[letter] = audioBuffer;
    console.log(`โ ุชู ุชุญููู ${type}: ${letter}`);
    return true;
  } catch (error) {
    console.warn(`โ๏ธ ูุดู ุชุญููู ${type} ${letter}:`, error);
    return false;
  }
}

// ุชุญููู ุฌููุน ุงูุฃุตูุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
// ุชุญููู ุฌููุน ุงูุฃุตูุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
window.addEventListener("DOMContentLoaded", async () => {
  console.log("๐ ุจุฏุก ุชุญููู ุงูุฃุตูุงุช...");
  initAudioContext();

  // ุชุญููู ุฃุตูุงุช ุงูุญุฑูู
  const letterPromises = Object.entries(audioSources).map(([letter, url]) =>
    loadAudioFile(letter, url, audioBuffers),
  );

  // ุชุญููู ุฃุตูุงุช ุงูุฃูุซูุฉ
  const examplePromises = Object.entries(exampleSources).map(([letter, url]) =>
    loadAudioFile(letter, url, exampleBuffers, "ูุซุงู"),
  );

  await Promise.all([...letterPromises, ...examplePromises]);
  isAudioReady = true;
  console.log("๐ต ุฌููุน ุงูุฃุตูุงุช ูุงูุฃูุซูุฉ ุฌุงูุฒุฉ!");
});
// ====================================
// ุฏุงูุฉ ุชุดุบูู ุงูููุฏูู ุนูุฏ ุงูุถุบุท ุนูู ุงููุงุฑุฏ
// ====================================
function playCardVideo(card) {
  const video = card.querySelector("video");
  const overlay = card.querySelector(".video-overlay");

  if (!video) return;

  if (video.paused) {
    document.querySelectorAll("video").forEach((v) => {
      if (v !== video) {
        v.pause();
        v.currentTime = 0;
        const ov = v.parentElement.querySelector(".video-overlay");
        if (ov) ov.classList.remove("hidden");
      }
    });

    video.play().catch(console.warn);
    if (overlay) overlay.classList.add("hidden");
  } else {
    video.pause();
    if (overlay) overlay.classList.remove("hidden");
  }
}

// ====================================
// ุฏุงูุฉ ุนุฑุถ ุงูุดุฑุญ ุงูุชูุตููู
// ====================================
function showDetail(letter) {
  const modal = document.getElementById("detailModal");
  const modalTitle = document.getElementById("modalTitle");
  const modalText = document.getElementById("modalText");

  modalTitle.textContent = letterDetails[letter].title;
  modalText.innerHTML = letterDetails[letter].text;

  modal.style.display = "flex";
}

// ====================================
// ุฏุงูุฉ ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
// ====================================
function closeModal() {
  document.getElementById("detailModal").style.display = "none";
}

// ====================================
// ุฏุงูุฉ ุชุดุบูู ูุทู ุงูุญุฑู - ููุฑู! โก
// ====================================
let currentSource = null; // ูุชุชุจุน ุงูุตูุช ุงูุญุงูู

function playLetter(letter) {
  const btn = event.target;
  btn.classList.add("playing");

  // ุงูุชุฃูุฏ ูู ุชูุนูู Audio Context
  if (!audioContext) {
    initAudioContext();
  }

  // ุงุณุชุฆูุงู Audio Context ูู ุญุงู ูุงู ูุชููู
  if (audioContext.state === "suspended") {
    audioContext.resume();
  }

  const buffer = audioBuffers[letter];

  if (buffer) {
    // ุฅููุงู ุฃู ุตูุช ูุดุชุบู ุญุงููุงู
    if (currentSource) {
      try {
        currentSource.stop();
      } catch (e) {
        // ุชุฌุงูู ุงูุฎุทุฃ ุฅุฐุง ูุงู ุงูุตูุช ูุชููู ุจุงููุนู
      }
    }

    // ุฅูุดุงุก ูุตุฏุฑ ุตูุช ุฌุฏูุฏ
    const source = audioContext.createBufferSource();
    source.buffer = buffer;
    source.connect(audioContext.destination);
    currentSource = source;

    // ุชุดุบูู ููุฑู! โก
    source.start(0);
    console.log(`โถ๏ธ ุชุดุบูู ุตูุช ุญุฑู: ${letter}`);

    // ุฅุฒุงูุฉ ุงูุชุฃุซูุฑ ุนูุฏ ุงูุชูุงุก ุงูุตูุช
    source.onended = () => {
      btn.classList.remove("playing");
      if (currentSource === source) {
        currentSource = null;
      }
    };
  } else {
    // ุงูููู ูู ููุญูู ุจุนุฏ
    alert(
      `ุงูููู ุงูุตูุชู ููุญุฑู "${letter}" ูู ููุชูู ุชุญูููู ุจุนุฏ.\n\nูุฑุฌู ุงูุงูุชุธุงุฑ ููููุงู ุซู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.`,
    );
    btn.classList.remove("playing");
    console.warn(`โ๏ธ ุงูููู ุงูุตูุชู ููุญุฑู ${letter} ุบูุฑ ุฌุงูุฒ`);
  }

  // ๐ฌ ุชุดุบูู ุงูููุฏูู ุชููุงุฆูุงู
  const card = btn.closest(".card");
  if (card) {
    playCardVideo(card);
  }
}

// ====================================
// ุฏุงูุฉ ุชุดุบูู ูุซุงู ุงูุญุฑู ูู ุงููุฑุขู
// ====================================
// ====================================
// ุฏุงูุฉ ุชุดุบูู ูุซุงู ุงูุญุฑู ูู ุงููุฑุขู - ููุฑู! โก
// ====================================
let currentExampleSource = null; // ูุชุชุจุน ุตูุช ุงููุซุงู ุงูุญุงูู

function playExample(letter) {
  const btn = event.target;
  btn.classList.add("playing");

  // ุงูุชุฃูุฏ ูู ุชูุนูู Audio Context
  if (!audioContext) {
    initAudioContext();
  }

  // ุงุณุชุฆูุงู Audio Context ูู ุญุงู ูุงู ูุชููู
  if (audioContext.state === "suspended") {
    audioContext.resume();
  }

  const buffer = exampleBuffers[letter];

  if (buffer) {
    // ุฅููุงู ุฃู ูุซุงู ูุดุชุบู ุญุงููุงู
    if (currentExampleSource) {
      try {
        currentExampleSource.stop();
      } catch (e) {
        // ุชุฌุงูู ุงูุฎุทุฃ ุฅุฐุง ูุงู ุงูุตูุช ูุชููู ุจุงููุนู
      }
    }

    // ุฅูุดุงุก ูุตุฏุฑ ุตูุช ุฌุฏูุฏ
    const source = audioContext.createBufferSource();
    source.buffer = buffer;
    source.connect(audioContext.destination);
    currentExampleSource = source;

    // ุชุดุบูู ููุฑู! โก
    source.start(0);
    console.log(`โถ๏ธ ุชุดุบูู ูุซุงู ุญุฑู: ${letter}`);

    // ุฅุฒุงูุฉ ุงูุชุฃุซูุฑ ุนูุฏ ุงูุชูุงุก ุงูุตูุช
    source.onended = () => {
      btn.classList.remove("playing");
      if (currentExampleSource === source) {
        currentExampleSource = null;
      }
    };
  } else {
    // ุงูููู ูู ููุญูู ุจุนุฏ
    const example = letterExamples[letter];
    alert(
      `ุงูููู ุงูุตูุชู ูููุซุงู "${example}" ูู ููุชูู ุชุญูููู ุจุนุฏ.\n\nูุฑุฌู ุงูุงูุชุธุงุฑ ููููุงู ุซู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.`,
    );
    btn.classList.remove("playing");
    console.warn(`โ๏ธ ุงูููู ุงูุตูุชู ูููุซุงู ${letter} ุบูุฑ ุฌุงูุฒ`);
  }
  // ๐ฌ ุชุดุบูู ุงูููุฏูู ุชููุงุฆูุงู
  const card = btn.closest(".card");
  if (card) {
    playCardVideo(card);
  }
}

// ====================================
// ุฅุธูุงุฑ ุฃููููุฉ ุงูุชุดุบูู ุนูุฏ ุงูุชูุงุก ุงูููุฏูู
// ====================================
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll("video").forEach((video) => {
    video.addEventListener("ended", function () {
      const overlay = this.parentElement.querySelector(".video-overlay");
      overlay.classList.remove("hidden");
      this.currentTime = 0;
    });
  });
});

// ====================================
// ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌูุง
// ====================================
window.onclick = function (event) {
  const modal = document.getElementById("detailModal");
  if (event.target == modal) {
    closeModal();
  }
};
